<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <script src="./lib/seedrandom.min.js"></script>
  <script src="./lib/d3.v5.min.js"></script>
  <script src="./lib/glpk.min.js"></script>
  <script src="./lib/mysql.umd.js"></script>
  <script src="./js/query_samples/queries.js"></script>

  <link rel="stylesheet" href="./css/bootstrap.min.css">

  <script src="./simple/simplegraph.js"></script>
  <script src="./simple/simpleLp.js"></script>
  <script src="./simple/testCaseGenerator.js"></script>
</head>

<style>
    body {
        font-family: Arial, Helvetica, sans-serif;
        margin: 5%;
    }

    svg {
        margin: 1%;
        background-color: white;
    }

    .modelDivClass {
        font-size: xx-small;
        white-space: pre-wrap;
        font-family: "Lucida Console", Monaco, monospace;
        background-color: #eee;
        padding: 2%;
        border-radius: 4px;
        margin: 1%;
        min-width: 150px;
    }

    .flexbreak {
        flex-basis: 100%;
        height: 0;
    }
</style>

<body>
    <!-- bootstrap -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>

<script>

    let drawTest = (test, testRow) => {

        let mkx = (elem) => {
            return "x_" + elem[0].id + "_" + elem[1].id
        }

        let div = testRow
            .append('div')
            .style('width', '20%')

        let svg = div
            .append('svg')
            .style('width', '100%')
            .style('height', '200px')

        if (test.forceOrder != undefined){
            let rt = div.append('div')
                .attr('class', 'modelDivClass')
                .html('<b>forced vars<b>\n')

            for (elem of test.forceOrder){
                rt.append('text')
                    .text(mkx(elem) + '\n')
            }
        }

        if (!test.algorithm.model.minimize.includes('empty')){
            div.append('div')
                .attr('class', 'modelDivClass')
                .html(test.algorithm.model.minimize.substring(0, test.algorithm.model.minimize.length - 1).replace('Minimize', '<b>Minimize</b>'))
        }

        div.append('div')
            .attr('class', 'modelDivClass')
            .html(test.algorithm.model.subjectTo.replace('Subject To', '<b>Subject To</b>'))
            .style('max-height', '200px')
            .style('overflow-y', 'scroll')

        let rt = div.append('div')
            .attr('class', 'modelDivClass')
            .html('<b>result</b>\n')

        for (elem in test.algorithm.result){
            if (elem == "empty") continue;
            let r = rt.append('text')
                .html(elem + ": " + test.algorithm.result[elem] + '\n')

            if (test.forceOrder != undefined){
                let found = true;
                for (el of test.forceOrder){
                    if (mkx(el) == elem){
                        found = false;
                    }
                }
                if (found) r.html("<b>" + elem + ": " + test.algorithm.result[elem] + '</b>\n')
            }
        }

        test.graph.draw(svg);

        if (test.forceOrder != undefined){
            for (o of test.forceOrder){
                for (n of o){
                    svg.selectAll('.node')
                        .filter(no => no.id == n.id)
                        .attr('fill', 'red')
                }
            }
        }
    }
    
    let testGenerator = new TestCaseGenerator();

    d3.select('body')
        .append('div')
        .html('<h1>Simple Intersection</h1>')

    let testRow = d3.select('body')
        .append('div')
        .style('display', 'flex') 

    for (test of testGenerator.gen2x2CrossingTest()){
        drawTest(test, testRow);
    }

    d3.select('body')
        .append('div')
        .html('<h1>Simple Transitivity</h1>')

    testRow = d3.select('body')
        .append('div')
        .style('display', 'flex')
        .style('margin-top', '20px')

    for (test of testGenerator.genTransitivityTest()){
        drawTest(test, testRow);
    }

    d3.select('body')
        .append('div')
        .html('<h1>Single-rank grouping (2 elems per group)</h1>')

    testRow = d3.select('body')
        .append('div')
        .style('display', 'flex')
        .style('margin-top', '20px')

    for (test of testGenerator.genGroupTest(2, 1)){
        drawTest(test, testRow);
    }

    d3.select('body')
        .append('div')
        .html('<h1>Single-rank grouping (3 elems per group)</h1>')

    testRow = d3.select('body')
        .append('div')
        .style('display', 'flex')
        .style('margin-top', '20px')

    for (test of testGenerator.genGroupTest(3, 1)){
        drawTest(test, testRow);
    }

    d3.select('body')
        .append('div')
        .html('<h1>Same rank edges</h1>')

    testRow = d3.select('body')
        .append('div')
        .style('display', 'flex')
        .style('margin-top', '20px')

    for (test of testGenerator.genSameRankEdgesTest()){
        drawTest(test, testRow);
    }

    d3.select('body')
        .append('div')
        .html('<h1>Same rank edges and two-rank edges</h1>')

    testRow = d3.select('body')
        .append('div')
        .style('display', 'flex')
        .style('margin-top', '20px')

    for (test of testGenerator.genSameRankEdgesPlusTwoRankEdgesTest()){
        drawTest(test, testRow);
    }
    
</script>

</html>