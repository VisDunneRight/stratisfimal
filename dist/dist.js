class Attribute{constructor(t,s){this.table=t,this.name=s,this.attr=s,this.weight=0,this.diffEdges=0,this.randomEdges=0,this.sameEdges=0}}
class Edge{constructor(t,e,i,h){this.leftTable=t,this.att1=e,this.leftAttribute=e,this.rightTable=i,this.att2=h,this.rightAttribute=h}compareTo(t){if(this.leftTable==t.leftTable)if(this.rightTable==t.rightTable){if(this.leftAttribute.weight>t.leftAttribute.weight&&this.rightAttribute.weight<t.rightAttribute.weight)return!0;if(this.leftAttribute.weight<t.leftAttribute.weight&&this.rightAttribute.weight>t.rightAttribute.weight)return!0}else{if(this.rightTable.weight<t.rightTable.weight&&this.leftAttribute.weight>t.leftAttribute.weight)return!0;if(this.rightTable.weight>t.rightTable.weight&&this.leftAttribute.weight<t.leftAttribute.weight)return!0}else if(this.rightTable==t.rightTable)if(this.leftTable==t.leftTable){if(this.leftAttribute.weight>t.leftAttribute.weight&&this.rightAttribute.weight<t.rightAttribute.weight)return!0;if(this.leftAttribute.weight<t.leftAttribute.weight&&this.rightAttribute.weight>t.rightAttribute.weight)return!0}else{if(this.leftTable.weight<t.leftTable.weight&&this.rightAttribute.weight>t.rightAttribute.weight)return!0;if(this.leftTable.weight>t.leftTable.weight&&this.rightAttribute.weight<t.rightAttribute.weight)return!0}else{if(this.leftTable.weight<t.leftTable.weight&&this.rightTable.weight>t.rightTable.weight)return!0;if(this.leftTable.weight>t.leftTable.weight&&this.rightTable.weight<t.rightTable.weight)return!0}return!1}crosses(t){return this.leftTable.depth!=this.rightTable.depth&&t.leftTable.depth!=t.rightTable.depth&&!!this.compareTo(t)}}
class Graph{constructor(){this.edges=[],this.tables=[],this.tableIndex=[],this.edgeIndex=[],this.maxDepth=0,this.newLayer()}newLayer(){this.tableIndex.push([]),this.edgeIndex.push([])}addTable(t){for(;this.maxDepth<t.depth;)this.maxDepth+=1,this.newLayer();this.tables.push(t),this.tableIndex[t.depth].push(t)}addEdge(t){this.edges.push(t),this.edgeIndex[t.leftTable.depth].push(t)}ensureUniqueEdges(){}getEdgeCrossings(){let t=0;for(let e in this.edgeIndex)t+=this.getEdgeCrossingsAtDepth(e);return t}getEdgeCrossingsAtDepth(t){let e=0,s=this.edgeIndex[t];for(let t in s){let h=s[t];for(let i=parseFloat(t)+1;i<s.length;i++){let t=s[i];h.crosses(t)&&(console.log("Edge "+h.leftAttribute.name+h.rightAttribute.name+" crosses "+t.leftAttribute.name+t.rightAttribute.name),e+=1)}}return e}sortGraph(){for(let t of this.tables)t.main||(t.attributes=t.attributes.sort((t,e)=>t.weight>e.weight?1:-1));this.tables=this.tables.sort((t,e)=>t.weight>e.weight?1:-1)}setExactWeights(){for(let t in this.tableIndex){let e=this.tableIndex[t];e=e.sort((t,e)=>t.weight>e.weight?1:-1);for(let t in e){let s=e[t];s.weight=t;let h=s.attributes;h=h.sort((t,e)=>t.weight>e.weight?1:-1);for(let t in h)h[t].weight=t}}}}
class GraphGenerator{constructor(t=3,e="hello",r=[2,3],a=[1,5]){this.d=t,this.s=3,this.jd=.1,this.js=.05,this.attributeCounter=0,this.seed=e,this.rng=new Math.seedrandom(this.seed),this.tableDist=()=>r[0]+Math.round(this.rng()*(r[1]-r[0])),this.attrDist=()=>a[0]+Math.round(this.rng()*(a[1]-a[0]))}generate(){g=new Graph;for(var t=1;t<this.d;t++){g.newLayer();for(var e=0;e<this.tableDist();e++)g.addTable(this.generateTable(t,e))}return this.generateProjections(g),this.generateJoins(g),g.ensureUniqueEdges(),g}generateTable(t,e){name="T"+t+"_"+e;for(var r=new Table(name,name,!1,t),a=0;a<this.attrDist();a++)r.addAttribute("a"+this.attributeCounter),this.attributeCounter+=1;return r}generateProjections(t){let e=t.tableIndex[1],r=[],a=new Table("select","SELECT",!0,0),s=[],n=[],i=0;for(let t of e){let e=t.attributes,a=e[Math.floor(this.rng()*e.length)];s.push(a),n.push(a);for(let s of e)s!=a&&r.push(new Attribute(t,s));i++}let o=this.s*(r.length+i);for(t.addTable(a);i<o;i++){let t=Math.floor(this.rng()*r.length);r[t];r.splice(t,1)}for(let e of s){let r=new Attribute(a,"a"+this.attributeCounter++);a.attributes.push(r),t.addEdge(new Edge(a,r,e.table,e))}}generateInterLayerJoins(t){for(var e=1;e<this.d;e++){let r=t.tableIndex[e],a=t.tableIndex[e+1],s=[],n=[];for(let t of r){let e=t.attributes;for(let r of e)s.push(new Attribute(t,r))}for(let e of a){if(0==s.length)break;let r=e.attributes,a=r[Math.floor(this.rng()*r.length)],i=Math.floor(this.rng()*s.length),o=s[i];s.splice(i,1),t.addEdge(new Edge(o.table,o.attr,e,a)),o.diffEdges++,a.diffEdges++;for(let t of r)t!=a&&n.push(new Attribute(e,t))}for(let e of s){if(0==n.length)break;if(this.rng()<this.jd){let r=Math.floor(this.rng()*n.length),a=n[r];n.splice(r,1),t.addEdge(new Edge(e.table,e.attr,a.table,a.attr)),e.diffEdges++,a.diffEdges++}}}}generateInLayerJoins(){for(var t=1;t<this.d;t++){let e=g.tableIndex[t];for(let t of e){let r=[],a=[];for(let e of t.attributes)r.push(new Attribute(t,e));for(let r of e)if(t!=r)for(let t of r.attributes)0==t.sameEdges&&a.push(new Attribute(r,t));for(let t of r){if(0==a.length)break;if(this.rng()<this.js){let e=Math.floor(this.rng()*a.length),r=a[e];a.splice(e,1),g.addEdge(new Edge(t.table,t.attr,r.table,r.attr)),t.sameEdges++,r.sameEdges++}}}}}generateRandomJoins(){}generateJoins(t){this.generateInterLayerJoins(t),this.generateInLayerJoins(t),this.generateRandomJoins(t)}}
class Table{constructor(t,h,i,e){this.name=t,this.header=h,this.main=i,this.depth=e,this.attributes=[],this.attrMaps=[],this.weight=0}addAttribute(t){this.attributes.push(new Attribute(this,t))}compareTo(t){return this.depth<t.depth?-1:this.depth>t.depth?1:this.weight>t.weight}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkF0dHJpYnV0ZS5qcyIsIkVkZ2UuanMiLCJHcmFwaC5qcyIsIkdyYXBoR2VuZXJhdG9yLmpzIiwiVGFibGUuanMiXSwibmFtZXMiOlsiQXR0cmlidXRlIiwiW29iamVjdCBPYmplY3RdIiwidGFibGUiLCJuYW1lIiwidGhpcyIsImF0dHIiLCJ3ZWlnaHQiLCJkaWZmRWRnZXMiLCJyYW5kb21FZGdlcyIsInNhbWVFZGdlcyIsIkVkZ2UiLCJsZWZ0VGFibGUiLCJhdHQxIiwicmlndGhUYWJsZSIsImF0dDIiLCJsZWZ0QXR0cmlidXRlIiwicmlnaHRUYWJsZSIsInJpZ2h0QXR0cmlidXRlIiwib3RoZXJFZGdlIiwiZGVwdGgiLCJjb21wYXJlVG8iLCJHcmFwaCIsImVkZ2VzIiwidGFibGVzIiwidGFibGVJbmRleCIsImVkZ2VJbmRleCIsIm1heERlcHRoIiwibmV3TGF5ZXIiLCJwdXNoIiwiZWRnZSIsImNvdW50IiwiZCIsImdldEVkZ2VDcm9zc2luZ3NBdERlcHRoIiwiY3Jvc3NpbmdzIiwibGF5ZXJFZGdlcyIsImkiLCJjdXJyRWRnZSIsImoiLCJwYXJzZUZsb2F0IiwibGVuZ3RoIiwiY3Jvc3NlcyIsImNvbnNvbGUiLCJsb2ciLCJ0IiwibWFpbiIsImF0dHJpYnV0ZXMiLCJzb3J0IiwiYSIsImIiLCJsYXllclRhYmxlcyIsImF0dHJzIiwiayIsIkdyYXBoR2VuZXJhdG9yIiwic2VlZCIsInRhYmxlRGlzdHJpYnV0aW9uIiwiYXR0cmlidXRlRGlzdHJpYnV0aW9uIiwicyIsImpkIiwianMiLCJhdHRyaWJ1dGVDb3VudGVyIiwicm5nIiwiTWF0aCIsInNlZWRyYW5kb20iLCJ0YWJsZURpc3QiLCJyb3VuZCIsImF0dHJEaXN0IiwiZyIsImFkZFRhYmxlIiwiZ2VuZXJhdGVUYWJsZSIsImdlbmVyYXRlUHJvamVjdGlvbnMiLCJnZW5lcmF0ZUpvaW5zIiwiZW5zdXJlVW5pcXVlRWRnZXMiLCJpbmRleCIsIm5ld1RhYmxlIiwiVGFibGUiLCJhZGRBdHRyaWJ1dGUiLCJsYXllcjEiLCJsYXllcjFhdHRycyIsInNlbGVjdFRhYmxlIiwicHJvamVjdGVkQXR0cnMiLCJwcm9qZWN0ZWQiLCJwcm9qZWN0ZWRDb3VudCIsInN0cmljdCIsImZsb29yIiwiY291bnRQcm9qZWN0aW9ucyIsImF0dHJJbmRleCIsInNwbGljZSIsIm5ld0F0dHIiLCJhZGRFZGdlIiwibGVmdExheWVyIiwicmlnaHRMYXllciIsImxlZnRMYXllckF0dHJzIiwicmlnaHRMYXllckF0dHJzIiwibGVmdEluZGV4IiwibGVmdCIsInJpZ2h0SW5kZXgiLCJyaWdodCIsImxheWVyIiwidDEiLCJhdHRyczEiLCJhdHRyczIiLCJ0MiIsImF0dHIxIiwiYXR0cjJpbmRleCIsImF0dHIyIiwiZ2VuZXJhdGVJbnRlckxheWVySm9pbnMiLCJnZW5lcmF0ZUluTGF5ZXJKb2lucyIsImdlbmVyYXRlUmFuZG9tSm9pbnMiLCJoZWFkZXIiLCJhdHRyTWFwcyIsImF0dHJpYnV0ZSIsIm90aGVyVGFibGUiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFVBQ0ZDLFlBQVlDLEVBQU9DLEdBQ2ZDLEtBQUtGLE1BQVFBLEVBQ2JFLEtBQUtELEtBQU9BLEVBQ1pDLEtBQUtDLEtBQU9GLEVBQ1pDLEtBQUtFLE9BQVMsRUFDZEYsS0FBS0csVUFBWSxFQUNqQkgsS0FBS0ksWUFBYyxFQUNuQkosS0FBS0ssVUFBWTtBQ1J6QixNQUFNQyxLQUNGVCxZQUFZVSxFQUFXQyxFQUFNQyxFQUFZQyxHQUNyQ1YsS0FBS08sVUFBWUEsRUFDakJQLEtBQUtRLEtBQU9BLEVBQ1pSLEtBQUtXLGNBQWdCSCxFQUNyQlIsS0FBS1ksV0FBYUgsRUFDbEJULEtBQUtVLEtBQU9BLEVBQ1pWLEtBQUthLGVBQWlCSCxFQUcxQmIsVUFBVWlCLEdBQ04sR0FBSWQsS0FBS08sV0FBYU8sRUFBVVAsVUFFNUIsR0FBSVAsS0FBS1ksWUFBY0UsRUFBVUYsV0FBVyxDQUV4QyxHQUFJWixLQUFLVyxjQUFjVCxPQUFTWSxFQUFVSCxjQUFjVCxRQUFVRixLQUFLYSxlQUFl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QWxCeEMsRUFBS0ksV0FDTDJGLEVBQU94RSxLQUFLLElBQUk1QixVQUFVcUcsRUFBSWhHLElBSTFDLElBQUssSUFBSWlHLEtBQVNILEVBQU8sQ0FDckIsR0FBcUIsR0FBakJDLEVBQU83RCxPQUFhLE1BQ3hCLEdBQUluQyxLQUFLd0QsTUFBUXhELEtBQUtzRCxHQUFHLENBQ3JCLElBQUk2QyxFQUFhMUMsS0FBS3NCLE1BQU0vRSxLQUFLd0QsTUFBTXdDLEVBQU83RCxRQUMxQ2lFLEVBQVFKLEVBQU9HLEdBQ25CSCxFQUFPZCxPQUFPaUIsRUFBWSxHQUUxQnJDLEVBQUVzQixRQUFRLElBQUk5RSxLQUFLNEYsRUFBTXBHLE1BQU9vRyxFQUFNakcsS0FBTW1HLEVBQU10RyxNQUFPc0csRUFBTW5HLE9BRS9EaUcsRUFBTTdGLFlBQ04rRixFQUFNL0YsZ0JBTzFCUix1QkFJQUEsY0FBY2lFLEdBQ1Y5RCxLQUFLcUcsd0JBQXdCdkMsR0FDN0I5RCxLQUFLc0cscUJBQXFCeEMsR0FDMUI5RCxLQUFLdUcsb0JBQW9CekM7QUN2TGpDLE1BQU1RLE1BQ0Z6RSxZQUFZRSxFQUFNeUcsRUFBUWhFLEVBQU16QixHQUM1QmYsS0FBS0QsS0FBT0EsRUFDWkMsS0FBS3dHLE9BQVNBLEVBQ2R4RyxLQUFLd0MsS0FBT0EsRUFDWnhDLEtBQUtlLE1BQVFBLEVBQ2JmLEtBQUt5QyxXQUFhLEdBQ2xCekMsS0FBS3lHLFNBQVcsR0FDaEJ6RyxLQUFLRSxPQUFTLEVBR2xCTCxhQUFhNkcsR0FDVDFHLEtBQUt5QyxXQUFXakIsS0FBSyxJQUFJNUIsVUFBVUksS0FBTTBHLElBRzdDN0csVUFBVThHLEdBQ04sT0FBSTNHLEtBQUtlLE1BQVE0RixFQUFXNUYsT0FBZSxFQUNsQ2YsS0FBS2UsTUFBUTRGLEVBQVc1RixNQUFjLEVBQ25DZixLQUFLRSxPQUFTeUcsRUFBV3pHIiwiZmlsZSI6ImRpc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBBdHRyaWJ1dGUge1xyXG4gICAgY29uc3RydWN0b3IodGFibGUsIG5hbWUpe1xyXG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuYXR0ciA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy53ZWlnaHQgPSAwO1xyXG4gICAgICAgIHRoaXMuZGlmZkVkZ2VzID0gMDtcclxuICAgICAgICB0aGlzLnJhbmRvbUVkZ2VzID0gMDtcclxuICAgICAgICB0aGlzLnNhbWVFZGdlcyA9IDA7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBFZGdlIHtcclxuICAgIGNvbnN0cnVjdG9yKGxlZnRUYWJsZSwgYXR0MSwgcmlndGhUYWJsZSwgYXR0Mil7XHJcbiAgICAgICAgdGhpcy5sZWZ0VGFibGUgPSBsZWZ0VGFibGU7XHJcbiAgICAgICAgdGhpcy5hdHQxID0gYXR0MTtcclxuICAgICAgICB0aGlzLmxlZnRBdHRyaWJ1dGUgPSBhdHQxO1xyXG4gICAgICAgIHRoaXMucmlnaHRUYWJsZSA9IHJpZ3RoVGFibGU7XHJcbiAgICAgICAgdGhpcy5hdHQyID0gYXR0MjtcclxuICAgICAgICB0aGlzLnJpZ2h0QXR0cmlidXRlID0gYXR0MjtcclxuICAgIH1cclxuXHJcbiAgICBjb21wYXJlVG8ob3RoZXJFZGdlKXtcclxuICAgICAgICBpZiAodGhpcy5sZWZ0VGFibGUgPT0gb3RoZXJFZGdlLmxlZnRUYWJsZSl7XHJcbiAgICAgICAgICAgIC8vIGVkZ2VzIGhhdmUgdGhlIHNhbWUgbGVmdCB0YWJsZVxyXG4gICAgICAgICAgICBpZiAodGhpcy5yaWdodFRhYmxlID09IG90aGVyRWRnZS5yaWdodFRhYmxlKXtcclxuICAgICAgICAgICAgICAgIC8vIGFuZCB0aGUgc2FtZSByaWdodCB0YWJsZVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGVmdEF0dHJpYnV0ZS53ZWlnaHQgPiBvdGhlckVkZ2UubGVmdEF0dHJpYnV0ZS53ZWlnaHQgJiYgdGhpcy5yaWdodEF0dHJpYnV0ZS53ZWlnaHQgPCBvdGhlckVkZ2UucmlnaHRBdHRyaWJ1dGUud2VpZ2h0KVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5sZWZ0QXR0cmlidXRlLndlaWdodCA8IG90aGVyRWRnZS5sZWZ0QXR0cmlidXRlLndlaWdodCAmJiB0aGlzLnJpZ2h0QXR0cmlidXRlLndlaWdodCA+IG90aGVyRWRnZS5yaWdodEF0dHJpYnV0ZS53ZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5yaWdodFRhYmxlLndlaWdodCA8IG90aGVyRWRnZS5yaWdodFRhYmxlLndlaWdodCAmJiB0aGlzLmxlZnRBdHRyaWJ1dGUud2VpZ2h0ID4gb3RoZXJFZGdlLmxlZnRBdHRyaWJ1dGUud2VpZ2h0KVxyXG4gICAgICAgICAgICAgICAgLy8gcmlnaHQgdGFibGUgaXMgdW5kZXIgYnV0IGxlZnQgYXR0cmlidXRlIGlzIG92ZXJcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLnJpZ2h0VGFibGUud2VpZ2h0ID4gb3RoZXJFZGdlLnJpZ2h0VGFibGUud2VpZ2h0ICYmIHRoaXMubGVmdEF0dHJpYnV0ZS53ZWlnaHQgPCBvdGhlckVkZ2UubGVmdEF0dHJpYnV0ZS53ZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAvLyByaWdodCB0YWJsZSBpcyBvdmVyIGJ1dCBsZWZ0IGF0dHJpYnV0ZSBpcyB1bmRlclxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJpZ2h0VGFibGUgPT0gb3RoZXJFZGdlLnJpZ2h0VGFibGUpe1xyXG4gICAgICAgICAgICAvLyBlZGdlcyBoYXZlIHRoZSBzYW1lIHJpZ2h0IHRhYmxlXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxlZnRUYWJsZSA9PSBvdGhlckVkZ2UubGVmdFRhYmxlKXtcclxuICAgICAgICAgICAgICAgIC8vIGFuZCB0aGUgc2FtZSBsZWZ0IHRhYmxlXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5sZWZ0QXR0cmlidXRlLndlaWdodCA+IG90aGVyRWRnZS5sZWZ0QXR0cmlidXRlLndlaWdodCAmJiB0aGlzLnJpZ2h0QXR0cmlidXRlLndlaWdodCA8IG90aGVyRWRnZS5yaWdodEF0dHJpYnV0ZS53ZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmxlZnRBdHRyaWJ1dGUud2VpZ2h0IDwgb3RoZXJFZGdlLmxlZnRBdHRyaWJ1dGUud2VpZ2h0ICYmIHRoaXMucmlnaHRBdHRyaWJ1dGUud2VpZ2h0ID4gb3RoZXJFZGdlLnJpZ2h0QXR0cmlidXRlLndlaWdodClcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLmxlZnRUYWJsZS53ZWlnaHQgPCBvdGhlckVkZ2UubGVmdFRhYmxlLndlaWdodCAmJiB0aGlzLnJpZ2h0QXR0cmlidXRlLndlaWdodCA+IG90aGVyRWRnZS5yaWdodEF0dHJpYnV0ZS53ZWlnaHQpXHJcbiAgICAgICAgICAgICAgICAvLyBsZWZ0IHRhYmxlIGlzIHVuZGVyIGJ1dCByaWdodCBhdHRyaWJ1dGUgaXMgb3ZlclxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMubGVmdFRhYmxlLndlaWdodCA+IG90aGVyRWRnZS5sZWZ0VGFibGUud2VpZ2h0ICYmIHRoaXMucmlnaHRBdHRyaWJ1dGUud2VpZ2h0IDwgb3RoZXJFZGdlLnJpZ2h0QXR0cmlidXRlLndlaWdodClcclxuICAgICAgICAgICAgICAgIC8vIGxlZnQgdGFibGUgaXMgb3ZlciBidXQgcmlnaHQgYXR0cmlidXRlIGlzIHVuZGVyXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBlZGdlcyBoYXZlIGRpZmZlcmVudCB0YWJsZXMgYm90aCBvbiB0aGUgbGVmdCBhbmQgb24gdGhlIHJpZ2h0XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxlZnRUYWJsZS53ZWlnaHQgPCBvdGhlckVkZ2UubGVmdFRhYmxlLndlaWdodCAmJiB0aGlzLnJpZ2h0VGFibGUud2VpZ2h0ID4gb3RoZXJFZGdlLnJpZ2h0VGFibGUud2VpZ2h0KVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWVcclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5sZWZ0VGFibGUud2VpZ2h0ID4gb3RoZXJFZGdlLmxlZnRUYWJsZS53ZWlnaHQgJiYgdGhpcy5yaWdodFRhYmxlLndlaWdodCA8IG90aGVyRWRnZS5yaWdodFRhYmxlLndlaWdodCl7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG4gICAgY3Jvc3NlcyhvdGhlckVkZ2Upe1xyXG5cclxuICAgICAgICAvLyBjaGFuZ2UgdGhpcywgaXQncyBmb3Igc2VsZiBlZGdlc1xyXG4gICAgICAgIGlmICh0aGlzLmxlZnRUYWJsZS5kZXB0aCA9PSB0aGlzLnJpZ2h0VGFibGUuZGVwdGggfHwgb3RoZXJFZGdlLmxlZnRUYWJsZS5kZXB0aCA9PSBvdGhlckVkZ2UucmlnaHRUYWJsZS5kZXB0aCkgcmV0dXJuIGZhbHNlXHJcblxyXG4gICAgICAgIGlmICh0aGlzLmNvbXBhcmVUbyhvdGhlckVkZ2UpKXtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcblxyXG59IiwiY2xhc3MgR3JhcGgge1xyXG4gICAgY29uc3RydWN0b3IoKXtcclxuICAgICAgICB0aGlzLmVkZ2VzID0gW107IFxyXG4gICAgICAgIHRoaXMudGFibGVzID0gW107IFxyXG4gICAgICAgIHRoaXMudGFibGVJbmRleCA9IFtdOyBcclxuICAgICAgICB0aGlzLmVkZ2VJbmRleCA9IFtdO1xyXG4gICAgICAgIHRoaXMubWF4RGVwdGggPSAwO1xyXG4gICAgICAgIHRoaXMubmV3TGF5ZXIoKTtcclxuICAgIH1cclxuXHJcbiAgICBuZXdMYXllcigpe1xyXG4gICAgICAgIHRoaXMudGFibGVJbmRleC5wdXNoKFtdKVxyXG4gICAgICAgIHRoaXMuZWRnZUluZGV4LnB1c2goW10pXHJcbiAgICB9XHJcblxyXG4gICAgYWRkVGFibGUodGFibGUpe1xyXG4gICAgICAgIHdoaWxlKHRoaXMubWF4RGVwdGggPCB0YWJsZS5kZXB0aCl7XHJcbiAgICAgICAgICAgIHRoaXMubWF4RGVwdGgrPTE7XHJcbiAgICAgICAgICAgIHRoaXMubmV3TGF5ZXIoKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudGFibGVzLnB1c2godGFibGUpXHJcbiAgICAgICAgdGhpcy50YWJsZUluZGV4W3RhYmxlLmRlcHRoXS5wdXNoKHRhYmxlKVxyXG4gICAgfVxyXG5cclxuICAgIGFkZEVkZ2UoZWRnZSl7XHJcbiAgICAgICAgdGhpcy5lZGdlcy5wdXNoKGVkZ2UpXHJcbiAgICAgICAgdGhpcy5lZGdlSW5kZXhbZWRnZS5sZWZ0VGFibGUuZGVwdGhdLnB1c2goZWRnZSlcclxuICAgIH1cclxuXHJcbiAgICBlbnN1cmVVbmlxdWVFZGdlcygpe1xyXG4gICAgICAgIC8vIGZpbmlzaFxyXG4gICAgfVxyXG5cclxuICAgIGdldEVkZ2VDcm9zc2luZ3MoKXtcclxuICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgIGZvciAobGV0IGQgaW4gdGhpcy5lZGdlSW5kZXgpIGNvdW50ICs9IHRoaXMuZ2V0RWRnZUNyb3NzaW5nc0F0RGVwdGgoZCk7XHJcbiAgICAgICAgcmV0dXJuIGNvdW50O1xyXG4gICAgfVxyXG5cclxuICAgIGdldEVkZ2VDcm9zc2luZ3NBdERlcHRoKGQpe1xyXG4gICAgICAgIGxldCBjcm9zc2luZ3MgPSAwO1xyXG4gICAgICAgIGxldCBsYXllckVkZ2VzID0gdGhpcy5lZGdlSW5kZXhbZF07XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgaW4gbGF5ZXJFZGdlcyl7XHJcbiAgICAgICAgICAgIGxldCBjdXJyRWRnZSA9IGxheWVyRWRnZXNbaV07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSBwYXJzZUZsb2F0KGkpKzE7IGogPCBsYXllckVkZ2VzLmxlbmd0aDsgaisrKXtcclxuICAgICAgICAgICAgICAgIGxldCBvdGhlckVkZ2UgPSBsYXllckVkZ2VzW2pdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJFZGdlLmNyb3NzZXMob3RoZXJFZGdlKSl7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFZGdlIFwiICsgY3VyckVkZ2UubGVmdEF0dHJpYnV0ZS5uYW1lICsgY3VyckVkZ2UucmlnaHRBdHRyaWJ1dGUubmFtZSArIFwiIGNyb3NzZXMgXCIgKyBvdGhlckVkZ2UubGVmdEF0dHJpYnV0ZS5uYW1lICsgb3RoZXJFZGdlLnJpZ2h0QXR0cmlidXRlLm5hbWUpXHJcbiAgICAgICAgICAgICAgICAgICAgY3Jvc3NpbmdzKz0xO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBjcm9zc2luZ3NcclxuICAgIH1cclxuXHJcbiAgICBzb3J0R3JhcGgoKXtcclxuICAgICAgICBmb3IgKGxldCB0IG9mIHRoaXMudGFibGVzKXtcclxuICAgICAgICAgICAgaWYgKCF0Lm1haW4pIHtcclxuICAgICAgICAgICAgICAgIHQuYXR0cmlidXRlcyA9IHQuYXR0cmlidXRlcy5zb3J0KChhLCBiKSA9PiBhLndlaWdodCA+IGIud2VpZ2h0PyAxIDogLTEpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudGFibGVzID0gdGhpcy50YWJsZXMuc29ydCgoYSwgYikgPT4gYS53ZWlnaHQgPiBiLndlaWdodD8gMSA6IC0xKVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV4YWN0V2VpZ2h0cygpe1xyXG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy50YWJsZUluZGV4KXtcclxuICAgICAgICAgICAgbGV0IGxheWVyVGFibGVzID0gdGhpcy50YWJsZUluZGV4W2ldO1xyXG4gICAgICAgICAgICBsYXllclRhYmxlcyA9IGxheWVyVGFibGVzLnNvcnQoKGEsIGIpID0+IGEud2VpZ2h0ID4gYi53ZWlnaHQ/IDEgOiAtMSlcclxuICAgICAgICAgICAgZm9yIChsZXQgaiBpbiBsYXllclRhYmxlcyl7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGFibGUgPSBsYXllclRhYmxlc1tqXVxyXG4gICAgICAgICAgICAgICAgdGFibGUud2VpZ2h0ID0galxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBhdHRycyA9IHRhYmxlLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgICAgICAgICBhdHRycyA9IGF0dHJzLnNvcnQoKGEsIGIpID0+IGEud2VpZ2h0ID4gYi53ZWlnaHQ/IDEgOiAtMSlcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayBpbiBhdHRycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgYXR0cnNba10ud2VpZ2h0ID0ga1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiY2xhc3MgR3JhcGhHZW5lcmF0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoZGVwdGg9Mywgc2VlZD1cImhlbGxvXCIsIHRhYmxlRGlzdHJpYnV0aW9uID0gWzIsM10sIGF0dHJpYnV0ZURpc3RyaWJ1dGlvbj1bMSwgNV0pe1xyXG4gICAgICAgIHRoaXMuZCA9IGRlcHRoO1xyXG4gICAgICAgIHRoaXMucyA9IDM7XHJcbiAgICAgICAgdGhpcy5qZCA9IDAuMTtcclxuICAgICAgICB0aGlzLmpzID0gMC4wNTtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZUNvdW50ZXIgPSAwO1xyXG4gICAgICAgIHRoaXMuc2VlZCA9IHNlZWQ7XHJcblxyXG4gICAgICAgIC8vIHJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yc1xyXG4gICAgICAgIHRoaXMucm5nID0gbmV3IE1hdGguc2VlZHJhbmRvbSh0aGlzLnNlZWQpO1xyXG4gICAgICAgIHRoaXMudGFibGVEaXN0ID0gKCkgPT4gdGFibGVEaXN0cmlidXRpb25bMF0gKyBNYXRoLnJvdW5kKHRoaXMucm5nKCkgKiAodGFibGVEaXN0cmlidXRpb25bMV0gLSB0YWJsZURpc3RyaWJ1dGlvblswXSkpXHJcbiAgICAgICAgdGhpcy5hdHRyRGlzdCA9ICgpID0+IGF0dHJpYnV0ZURpc3RyaWJ1dGlvblswXSArIE1hdGgucm91bmQodGhpcy5ybmcoKSAqIChhdHRyaWJ1dGVEaXN0cmlidXRpb25bMV0gLSBhdHRyaWJ1dGVEaXN0cmlidXRpb25bMF0pKVxyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlKCl7XHJcbiAgICAgICAgZyA9IG5ldyBHcmFwaCgpXHJcblxyXG4gICAgICAgIGZvciAodmFyIGk9MTsgaTx0aGlzLmQ7IGkrKyl7XHJcbiAgICAgICAgICAgIGcubmV3TGF5ZXIoKVxyXG4gICAgICAgICAgICBmb3IgKHZhciBqPTA7IGo8dGhpcy50YWJsZURpc3QoKTsgaisrKXtcclxuICAgICAgICAgICAgICAgIGcuYWRkVGFibGUodGhpcy5nZW5lcmF0ZVRhYmxlKGksIGopKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdlbmVyYXRlUHJvamVjdGlvbnMoZyk7XHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZUpvaW5zKGcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGcuZW5zdXJlVW5pcXVlRWRnZXMoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVUYWJsZShkZXB0aCwgaW5kZXgpe1xyXG4gICAgICAgIG5hbWUgPSBcIlRcIiArIGRlcHRoICsgXCJfXCIgKyBpbmRleFxyXG4gICAgICAgIHZhciBuZXdUYWJsZSA9IG5ldyBUYWJsZShuYW1lLCBuYW1lLCBmYWxzZSwgZGVwdGgpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5hdHRyRGlzdCgpOyBpKyspe1xyXG4gICAgICAgICAgICBuZXdUYWJsZS5hZGRBdHRyaWJ1dGUoXCJhXCIgKyB0aGlzLmF0dHJpYnV0ZUNvdW50ZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZUNvdW50ZXIgKz0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdUYWJsZVxyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlUHJvamVjdGlvbnMoZyl7XHJcbiAgICAgICAgbGV0IGxheWVyMSA9IGcudGFibGVJbmRleFsxXTtcclxuICAgICAgICBsZXQgbGF5ZXIxYXR0cnMgPSBbXTtcclxuICAgICAgICBsZXQgc2VsZWN0VGFibGUgPSBuZXcgVGFibGUoXCJzZWxlY3RcIiwgXCJTRUxFQ1RcIiwgdHJ1ZSwgMClcclxuICAgICAgICBsZXQgcHJvamVjdGVkQXR0cnMgPSBbXTtcclxuICAgICAgICBsZXQgcHJvamVjdGVkID0gW107XHJcbiAgICAgICAgbGV0IHByb2plY3RlZENvdW50ID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgdCBvZiBsYXllcjEpe1xyXG4gICAgICAgICAgICBsZXQgYXR0cnMgPSB0LmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgICAgIGxldCBzdHJpY3RJbmRleCA9IE1hdGguZmxvb3IodGhpcy5ybmcoKSphdHRycy5sZW5ndGgpXHJcbiAgICAgICAgICAgIGxldCBzdHJpY3QgPSBhdHRyc1tzdHJpY3RJbmRleF1cclxuICAgICAgICAgICAgcHJvamVjdGVkQXR0cnMucHVzaChzdHJpY3QpXHJcbiAgICAgICAgICAgIHByb2plY3RlZC5wdXNoKHN0cmljdClcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgaWYgKGF0dHIgIT0gc3RyaWN0KXtcclxuICAgICAgICAgICAgICAgICAgICBsYXllcjFhdHRycy5wdXNoKG5ldyBBdHRyaWJ1dGUodCwgYXR0cikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcHJvamVjdGVkQ291bnQrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb3VudFByb2plY3Rpb25zID0gdGhpcy5zICogKGxheWVyMWF0dHJzLmxlbmd0aCArIHByb2plY3RlZENvdW50KVxyXG5cclxuICAgICAgICBnLmFkZFRhYmxlKHNlbGVjdFRhYmxlKVxyXG5cclxuICAgICAgICBmb3IgKDsgcHJvamVjdGVkQ291bnQ8Y291bnRQcm9qZWN0aW9uczsgcHJvamVjdGVkQ291bnQrKyl7XHJcbiAgICAgICAgICAgIGxldCBhdHRySW5kZXggPSBNYXRoLmZsb29yKHRoaXMucm5nKCkqbGF5ZXIxYXR0cnMubGVuZ3RoKVxyXG4gICAgICAgICAgICBsZXQgYXR0ciA9IGxheWVyMWF0dHJzW2F0dHJJbmRleF1cclxuICAgICAgICAgICAgbGF5ZXIxYXR0cnMuc3BsaWNlKGF0dHJJbmRleCwgMSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGF0dHIgb2YgcHJvamVjdGVkQXR0cnMpe1xyXG4gICAgICAgICAgICBsZXQgbmV3QXR0ciA9IG5ldyBBdHRyaWJ1dGUoc2VsZWN0VGFibGUsIFwiYVwiICsgdGhpcy5hdHRyaWJ1dGVDb3VudGVyKyspXHJcbiAgICAgICAgICAgIHNlbGVjdFRhYmxlLmF0dHJpYnV0ZXMucHVzaChuZXdBdHRyKVxyXG4gICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2Uoc2VsZWN0VGFibGUsIG5ld0F0dHIsIGF0dHIudGFibGUsIGF0dHIpKVxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIC8vIHdlaXJkLiBub3QgZmluaXNoZWQuXHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVJbnRlckxheWVySm9pbnMoZyl7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLmQ7IGkrKyl7XHJcbiAgICAgICAgICAgIGxldCBsZWZ0TGF5ZXIgPSBnLnRhYmxlSW5kZXhbaV07XHJcbiAgICAgICAgICAgIGxldCByaWdodExheWVyID0gZy50YWJsZUluZGV4W2kgKyAxXTtcclxuXHJcbiAgICAgICAgICAgIGxldCBsZWZ0TGF5ZXJBdHRycyA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgcmlnaHRMYXllckF0dHJzID0gW107XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCB0YWJsZSBvZiBsZWZ0TGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgbGV0IGF0dHJzID0gdGFibGUuYXR0cmlidXRlcztcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnRMYXllckF0dHJzLnB1c2gobmV3IEF0dHJpYnV0ZSh0YWJsZSwgYXR0cikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IHRhYmxlIG9mIHJpZ2h0TGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgaWYgKGxlZnRMYXllckF0dHJzLmxlbmd0aCA9PSAwKSBicmVhaztcclxuICAgICAgICAgICAgICAgIGxldCBhdHRycyA9IHRhYmxlLmF0dHJpYnV0ZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHN0cmljdCA9IGF0dHJzW01hdGguZmxvb3IodGhpcy5ybmcoKSphdHRycy5sZW5ndGgpXVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdEluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnJuZygpKmxlZnRMYXllckF0dHJzLmxlbmd0aClcclxuICAgICAgICAgICAgICAgIGxldCBsZWZ0ID0gbGVmdExheWVyQXR0cnNbbGVmdEluZGV4XVxyXG4gICAgICAgICAgICAgICAgbGVmdExheWVyQXR0cnMuc3BsaWNlKGxlZnRJbmRleCwgMSlcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2UobGVmdC50YWJsZSwgbGVmdC5hdHRyLCB0YWJsZSwgc3RyaWN0KSlcclxuXHJcbiAgICAgICAgICAgICAgICBsZWZ0LmRpZmZFZGdlcysrO1xyXG4gICAgICAgICAgICAgICAgc3RyaWN0LmRpZmZFZGdlcysrO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyICE9IHN0cmljdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRMYXllckF0dHJzLnB1c2gobmV3IEF0dHJpYnV0ZSh0YWJsZSwgYXR0cikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGxlZnQgb2YgbGVmdExheWVyQXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgaWYgKHJpZ2h0TGF5ZXJBdHRycy5sZW5ndGggPT0gMCkgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ybmcoKSA8IHRoaXMuamQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByaWdodEluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnJuZygpKnJpZ2h0TGF5ZXJBdHRycy5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJpZ2h0ID0gcmlnaHRMYXllckF0dHJzW3JpZ2h0SW5kZXhdXHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRMYXllckF0dHJzLnNwbGljZShyaWdodEluZGV4LCAxKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2UobGVmdC50YWJsZSwgbGVmdC5hdHRyLCByaWdodC50YWJsZSwgcmlnaHQuYXR0cikpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQuZGlmZkVkZ2VzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQuZGlmZkVkZ2VzKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVJbkxheWVySm9pbnMoKXtcclxuICAgICAgICBmb3IgKHZhciBpPTE7IGk8dGhpcy5kOyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgbGF5ZXIgPSBnLnRhYmxlSW5kZXhbaV07XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCB0MSBvZiBsYXllcil7XHJcbiAgICAgICAgICAgICAgICBsZXQgYXR0cnMxID0gW107XHJcbiAgICAgICAgICAgICAgICBsZXQgYXR0cnMyID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgYXR0ciBvZiB0MS5hdHRyaWJ1dGVzKXtcclxuICAgICAgICAgICAgICAgICAgICBhdHRyczEucHVzaChuZXcgQXR0cmlidXRlKHQxLCBhdHRyKSlcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB0MiBvZiBsYXllcil7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQxID09IHQyKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhdHRyIG9mIHQyLmF0dHJpYnV0ZXMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5zYW1lRWRnZXMgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzMi5wdXNoKG5ldyBBdHRyaWJ1dGUodDIsIGF0dHIpKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBhdHRyMSBvZiBhdHRyczEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyczIubGVuZ3RoID09IDApIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJuZygpIDwgdGhpcy5qcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdHRyMmluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnJuZygpKmF0dHJzMi5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdHRyMiA9IGF0dHJzMlthdHRyMmluZGV4XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyczIuc3BsaWNlKGF0dHIyaW5kZXgsIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2UoYXR0cjEudGFibGUsIGF0dHIxLmF0dHIsIGF0dHIyLnRhYmxlLCBhdHRyMi5hdHRyKSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHIxLnNhbWVFZGdlcysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyMi5zYW1lRWRnZXMrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVSYW5kb21Kb2lucygpe1xyXG4gICAgICAgIC8vIGZpbmlzaFxyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlSm9pbnMoZyl7XHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZUludGVyTGF5ZXJKb2lucyhnKTtcclxuICAgICAgICB0aGlzLmdlbmVyYXRlSW5MYXllckpvaW5zKGcpO1xyXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVSYW5kb21Kb2lucyhnKTtcclxuICAgIH1cclxufSIsImNsYXNzIFRhYmxlIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGhlYWRlciwgbWFpbiwgZGVwdGgpe1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5oZWFkZXIgPSBoZWFkZXI7XHJcbiAgICAgICAgdGhpcy5tYWluID0gbWFpbjtcclxuICAgICAgICB0aGlzLmRlcHRoID0gZGVwdGg7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gW107XHJcbiAgICAgICAgdGhpcy5hdHRyTWFwcyA9IFtdO1xyXG4gICAgICAgIHRoaXMud2VpZ2h0ID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBhZGRBdHRyaWJ1dGUoYXR0cmlidXRlKXtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMucHVzaChuZXcgQXR0cmlidXRlKHRoaXMsIGF0dHJpYnV0ZSkpXHJcbiAgICB9XHJcblxyXG4gICAgY29tcGFyZVRvKG90aGVyVGFibGUpe1xyXG4gICAgICAgIGlmICh0aGlzLmRlcHRoIDwgb3RoZXJUYWJsZS5kZXB0aCkgcmV0dXJuIC0xO1xyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZGVwdGggPiBvdGhlclRhYmxlLmRlcHRoKSByZXR1cm4gMTtcclxuICAgICAgICBlbHNlIHJldHVybiB0aGlzLndlaWdodCA+IG90aGVyVGFibGUud2VpZ2h0O1xyXG4gICAgfVxyXG59Il19
