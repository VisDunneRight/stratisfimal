class Attribute{constructor(t,s){this.table=t,this.name=s,this.attr=s,this.weight=0,this.diffEdges=0,this.randomEdges=0,this.sameEdges=0}}
class Edge{constructor(t,e,i,r){this.leftTable=t,this.att1=e,this.leftAttribute=e,this.rightTable=i,this.att2=r,this.rightAttribute=r}compareTo(t){if(null==t)return 1;let e=this.compareAttributes(this.leftTable,this.leftAttribute,t.leftTable,t.leftAttribute);return 0==e&&(e=this.compareAttributes(this.rightTable,this.rightAttribute,t.leftTable,t.leftAttribute)),e}crosses(t){return!!this.compareTo(t)}compareAttributes(t,e,i,r){return t.weight==i.weight?e.weight<r.weight:t.weight>i.weight}}
class Graph{constructor(){this.edges=[],this.tables=[],this.tableIndex=[],this.edgeIndex=[],this.maxDepth=0,this.newLayer()}newLayer(){this.tableIndex.push([]),this.edgeIndex.push([])}addTable(t){for(;this.maxDepth<t.depth;)this.maxDepth+=1,this.newLayer();this.tables.push(t),this.tableIndex[t.depth].push(t)}addEdge(t){this.edges.push(t),this.edgeIndex[t.leftTable.depth].push(t)}ensureUniqueEdges(){}getEdgeCrossings(){let t=0;for(let e in this.edgeIndex)t+=this.getEdgeCrossingsAtDepth(e);return t}getEdgeCrossingsAtDepth(t){let e=0,s=this.edgeIndex[t];for(let t in s){let h=s[t];for(let i=parseFloat(t)+1;i<s.length;i++){let t=s[i];h.crosses(t)&&console.log("Edge "+h.leftAttribute.name+h.rightAttribute.name+" crosses "+t.leftAttribute.name+t.rightAttribute.name),e++}}return e}sortGraph(){for(let t of this.tables)t.main||(t.attributes=t.attributes.sort((t,e)=>t.weight>e.weight?1:-1));this.tables=this.tables.sort((t,e)=>t.weight>e.weight?1:-1)}setExactWeights(){for(let t in this.tableIndex){let e=this.tableIndex[t];e=e.sort((t,e)=>t.weight>e.weight?1:-1);for(let t in e){let s=e[t];s.weight=t;let h=s.attributes;h=h.sort((t,e)=>t.weight>e.weight?1:-1);for(let t in h)h[t].weight=t}}}}
class GraphGenerator{constructor(t=3,e="hello",r=[2,3],a=[1,5]){this.d=t,this.s=3,this.jd=.1,this.js=.05,this.attributeCounter=0,this.seed=e,this.rng=new Math.seedrandom(this.seed),this.tableDist=()=>r[0]+Math.round(this.rng()*(r[1]-r[0])),this.attrDist=()=>a[0]+Math.round(this.rng()*(a[1]-a[0]))}generate(){g=new Graph;for(var t=1;t<this.d;t++){g.newLayer();for(var e=0;e<this.tableDist();e++)g.addTable(this.generateTable(t,e))}return this.generateProjections(g),this.generateJoins(g),g.ensureUniqueEdges(),g}generateTable(t,e){name="T"+t+"_"+e;for(var r=new Table(name,name,!1,t),a=0;a<this.attrDist();a++)r.addAttribute("a"+this.attributeCounter),this.attributeCounter+=1;return r}generateProjections(t){let e=t.tableIndex[1],r=[],a=new Table("select","SELECT",!0,0),s=[],n=[],i=0;for(let t of e){let e=t.attributes,a=e[Math.floor(this.rng()*e.length)];s.push(a),n.push(a);for(let s of e)s!=a&&r.push(new Attribute(t,s));i++}let o=this.s*(r.length+i);for(t.addTable(a);i<o;i++){let t=Math.floor(this.rng()*r.length);r[t];r.splice(t,1)}for(let e of s){let r=new Attribute(a,"a"+this.attributeCounter++);a.attributes.push(r),t.addEdge(new Edge(a,r,e.table,e))}}generateInterLayerJoins(t){for(var e=1;e<this.d;e++){let r=t.tableIndex[e],a=t.tableIndex[e+1],s=[],n=[];for(let t of r){let e=t.attributes;for(let r of e)s.push(new Attribute(t,r))}for(let e of a){if(0==s.length)break;let r=e.attributes,a=r[Math.floor(this.rng()*r.length)],i=Math.floor(this.rng()*s.length),o=s[i];s.splice(i,1),t.addEdge(new Edge(o.table,o.attr,e,a)),o.diffEdges++,a.diffEdges++;for(let t of r)t!=a&&n.push(new Attribute(e,t))}for(let e of s){if(0==n.length)break;if(this.rng()<this.jd){let r=Math.floor(this.rng()*n.length),a=n[r];n.splice(r,1),t.addEdge(new Edge(e.table,e.attr,a.table,a.attr)),e.diffEdges++,a.diffEdges++}}}}generateInLayerJoins(){for(var t=1;t<this.d;t++){let e=g.tableIndex[t];for(let t of e){let r=[],a=[];for(let e of t.attributes)r.push(new Attribute(t,e));for(let r of e)if(t!=r)for(let t of r.attributes)0==t.sameEdges&&a.push(new Attribute(r,t));for(let t of r){if(0==a.length)break;if(this.rng()<this.js){let e=Math.floor(this.rng()*a.length),r=a[e];a.splice(e,1),g.addEdge(new Edge(t.table,t.attr,r.table,r.attr)),t.sameEdges++,r.sameEdges++}}}}}generateRandomJoins(){}generateJoins(t){this.generateInterLayerJoins(t),this.generateInLayerJoins(t),this.generateRandomJoins(t)}}
class Table{constructor(t,h,i,e){this.name=t,this.header=h,this.main=i,this.depth=e,this.attributes=[],this.attrMaps=[],this.weight=0}addAttribute(t){this.attributes.push(new Attribute(this,t))}compareTo(t){return this.depth<t.depth?-1:this.depth>t.depth?1:this.weight>t.weight}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkF0dHJpYnV0ZS5qcyIsIkVkZ2UuanMiLCJHcmFwaC5qcyIsIkdyYXBoR2VuZXJhdG9yLmpzIiwiVGFibGUuanMiXSwibmFtZXMiOlsiQXR0cmlidXRlIiwiW29iamVjdCBPYmplY3RdIiwidGFibGUiLCJuYW1lIiwidGhpcyIsImF0dHIiLCJ3ZWlnaHQiLCJkaWZmRWRnZXMiLCJyYW5kb21FZGdlcyIsInNhbWVFZGdlcyIsIkVkZ2UiLCJsZWZ0VGFibGUiLCJhdHQxIiwicmlndGhUYWJsZSIsImF0dDIiLCJsZWZ0QXR0cmlidXRlIiwicmlnaHRUYWJsZSIsInJpZ2h0QXR0cmlidXRlIiwib3RoZXJFZGdlIiwidW5kZWZpbmVkIiwicmVzIiwiY29tcGFyZUF0dHJpYnV0ZXMiLCJjb21wYXJlVG8iLCJ0MSIsImExIiwidDIiLCJhMiIsIkdyYXBoIiwiZWRnZXMiLCJ0YWJsZXMiLCJ0YWJsZUluZGV4IiwiZWRnZUluZGV4IiwibWF4RGVwdGgiLCJuZXdMYXllciIsInB1c2giLCJkZXB0aCIsImVkZ2UiLCJjb3VudCIsImQiLCJnZXRFZGdlQ3Jvc3NpbmdzQXREZXB0aCIsImxheWVyRWRnZXMiLCJpIiwiY3VyckVkZ2UiLCJqIiwicGFyc2VGbG9hdCIsImxlbmd0aCIsImNyb3NzZXMiLCJjb25zb2xlIiwibG9nIiwidCIsIm1haW4iLCJhdHRyaWJ1dGVzIiwic29ydCIsImEiLCJiIiwibGF5ZXJUYWJsZXMiLCJhdHRycyIsImsiLCJHcmFwaEdlbmVyYXRvciIsInNlZWQiLCJ0YWJsZURpc3RyaWJ1dGlvbiIsImF0dHJpYnV0ZURpc3RyaWJ1dGlvbiIsInMiLCJqZCIsImpzIiwiYXR0cmlidXRlQ291bnRlciIsInJuZyIsIk1hdGgiLCJzZWVkcmFuZG9tIiwidGFibGVEaXN0Iiwicm91bmQiLCJhdHRyRGlzdCIsImciLCJhZGRUYWJsZSIsImdlbmVyYXRlVGFibGUiLCJnZW5lcmF0ZVByb2plY3Rpb25zIiwiZ2VuZXJhdGVKb2lucyIsImVuc3VyZVVuaXF1ZUVkZ2VzIiwiaW5kZXgiLCJuZXdUYWJsZSIsIlRhYmxlIiwiYWRkQXR0cmlidXRlIiwibGF5ZXIxIiwibGF5ZXIxYXR0cnMiLCJzZWxlY3RUYWJsZSIsInByb2plY3RlZEF0dHJzIiwicHJvamVjdGVkIiwicHJvamVjdGVkQ291bnQiLCJzdHJpY3QiLCJmbG9vciIsImNvdW50UHJvamVjdGlvbnMiLCJhdHRySW5kZXgiLCJzcGxpY2UiLCJuZXdBdHRyIiwiYWRkRWRnZSIsImxlZnRMYXllciIsInJpZ2h0TGF5ZXIiLCJsZWZ0TGF5ZXJBdHRycyIsInJpZ2h0TGF5ZXJBdHRycyIsImxlZnRJbmRleCIsImxlZnQiLCJyaWdodEluZGV4IiwicmlnaHQiLCJsYXllciIsImF0dHJzMSIsImF0dHJzMiIsImF0dHIxIiwiYXR0cjJpbmRleCIsImF0dHIyIiwiZ2VuZXJhdGVJbnRlckxheWVySm9pbnMiLCJnZW5lcmF0ZUluTGF5ZXJKb2lucyIsImdlbmVyYXRlUmFuZG9tSm9pbnMiLCJoZWFkZXIiLCJhdHRyTWFwcyIsImF0dHJpYnV0ZSIsIm90aGVyVGFibGUiXSwibWFwcGluZ3MiOiJBQUFBLE1BQU1BLFVBQ0ZDLFlBQVlDLEVBQU9DLEdBQ2ZDLEtBQUtGLE1BQVFBLEVBQ2JFLEtBQUtELEtBQU9BLEVBQ1pDLEtBQUtDLEtBQU9GLEVBQ1pDLEtBQUtFLE9BQVMsRUFDZEYsS0FBS0csVUFBWSxFQUNqQkgsS0FBS0ksWUFBYyxFQUNuQkosS0FBS0ssVUFBWTtBQ1J6QixNQUFNQyxLQUNGVCxZQUFZVSxFQUFXQyxFQUFNQyxFQUFZQyxHQUNyQ1YsS0FBS08sVUFBWUEsRUFDakJQLEtBQUtRLEtBQU9BLEVBQ1pSLEtBQUtXLGNBQWdCSCxFQUNyQlIsS0FBS1ksV0FBYUgsRUFDbEJULEtBQUtVLEtBQU9BLEVBQ1pWLEtBQUthLGVBQWlCSCxFQUcxQmIsVUFBVWlCLEdBQ04sR0FBaUJDLE1BQWJELEVBQXdCLE9BQU8sRUFDbkMsSUFBSUUsRUFBTWhCLEtBQUtpQixrQkFBa0JqQixLQUFLTyxVQUFXUCxLQUFLVyxjQUFl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aEYsT0FBZSxFQUNsQy9CLEtBQUsrQixNQUFRZ0YsRUFBV2hGLE1BQWMsRUFDbkMvQixLQUFLRSxPQUFTNkcsRUFBVzdHIiwiZmlsZSI6ImRpc3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBBdHRyaWJ1dGUge1xyXG4gICAgY29uc3RydWN0b3IodGFibGUsIG5hbWUpe1xyXG4gICAgICAgIHRoaXMudGFibGUgPSB0YWJsZTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuYXR0ciA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy53ZWlnaHQgPSAwO1xyXG4gICAgICAgIHRoaXMuZGlmZkVkZ2VzID0gMDtcclxuICAgICAgICB0aGlzLnJhbmRvbUVkZ2VzID0gMDtcclxuICAgICAgICB0aGlzLnNhbWVFZGdlcyA9IDA7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBFZGdlIHtcclxuICAgIGNvbnN0cnVjdG9yKGxlZnRUYWJsZSwgYXR0MSwgcmlndGhUYWJsZSwgYXR0Mil7XHJcbiAgICAgICAgdGhpcy5sZWZ0VGFibGUgPSBsZWZ0VGFibGU7XHJcbiAgICAgICAgdGhpcy5hdHQxID0gYXR0MTtcclxuICAgICAgICB0aGlzLmxlZnRBdHRyaWJ1dGUgPSBhdHQxO1xyXG4gICAgICAgIHRoaXMucmlnaHRUYWJsZSA9IHJpZ3RoVGFibGU7XHJcbiAgICAgICAgdGhpcy5hdHQyID0gYXR0MjtcclxuICAgICAgICB0aGlzLnJpZ2h0QXR0cmlidXRlID0gYXR0MjtcclxuICAgIH1cclxuXHJcbiAgICBjb21wYXJlVG8ob3RoZXJFZGdlKXtcclxuICAgICAgICBpZiAob3RoZXJFZGdlID09IHVuZGVmaW5lZCkgcmV0dXJuIDE7XHJcbiAgICAgICAgbGV0IHJlcyA9IHRoaXMuY29tcGFyZUF0dHJpYnV0ZXModGhpcy5sZWZ0VGFibGUsIHRoaXMubGVmdEF0dHJpYnV0ZSwgb3RoZXJFZGdlLmxlZnRUYWJsZSwgb3RoZXJFZGdlLmxlZnRBdHRyaWJ1dGUpXHJcbiAgICAgICAgaWYgKHJlcyA9PSAwKXtcclxuICAgICAgICAgICAgcmVzID0gdGhpcy5jb21wYXJlQXR0cmlidXRlcyh0aGlzLnJpZ2h0VGFibGUsIHRoaXMucmlnaHRBdHRyaWJ1dGUsIG90aGVyRWRnZS5sZWZ0VGFibGUsIG90aGVyRWRnZS5sZWZ0QXR0cmlidXRlKVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgfVxyXG5cclxuICAgIGNyb3NzZXMob3RoZXJFZGdlKXtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKG90aGVyRWRnZS5sZWZ0QXR0cmlidXRlLm5hbWUsIG90aGVyRWRnZS5yaWdodEF0dHJpYnV0ZS5uYW1lKVxyXG5cclxuICAgICAgICBpZiAodGhpcy5jb21wYXJlVG8ob3RoZXJFZGdlKSl7XHJcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2codGhpcy5sZWZ0QXR0cmlidXRlLCBvdGhlckVkZ2UubGVmdEF0dHJpYnV0ZSlcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBhZGQgcGFydCBmb3Igc2VsZiBlZGdlcz9cclxuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbXBhcmVBdHRyaWJ1dGVzKHQxLCBhMSwgdDIsIGEyKXtcclxuICAgICAgICBpZiAodDEud2VpZ2h0ID09IHQyLndlaWdodCkgcmV0dXJuIGExLndlaWdodCA8IGEyLndlaWdodFxyXG4gICAgICAgIGVsc2UgcmV0dXJuIHQxLndlaWdodCA+IHQyLndlaWdodDtcclxuICAgIH1cclxufSIsImNsYXNzIEdyYXBoIHtcclxuICAgIGNvbnN0cnVjdG9yKCl7XHJcbiAgICAgICAgdGhpcy5lZGdlcyA9IFtdOyBcclxuICAgICAgICB0aGlzLnRhYmxlcyA9IFtdOyBcclxuICAgICAgICB0aGlzLnRhYmxlSW5kZXggPSBbXTsgXHJcbiAgICAgICAgdGhpcy5lZGdlSW5kZXggPSBbXTtcclxuICAgICAgICB0aGlzLm1heERlcHRoID0gMDtcclxuICAgICAgICB0aGlzLm5ld0xheWVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmV3TGF5ZXIoKXtcclxuICAgICAgICB0aGlzLnRhYmxlSW5kZXgucHVzaChbXSlcclxuICAgICAgICB0aGlzLmVkZ2VJbmRleC5wdXNoKFtdKVxyXG4gICAgfVxyXG5cclxuICAgIGFkZFRhYmxlKHRhYmxlKXtcclxuICAgICAgICB3aGlsZSh0aGlzLm1heERlcHRoIDwgdGFibGUuZGVwdGgpe1xyXG4gICAgICAgICAgICB0aGlzLm1heERlcHRoKz0xO1xyXG4gICAgICAgICAgICB0aGlzLm5ld0xheWVyKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnRhYmxlcy5wdXNoKHRhYmxlKVxyXG4gICAgICAgIHRoaXMudGFibGVJbmRleFt0YWJsZS5kZXB0aF0ucHVzaCh0YWJsZSlcclxuICAgIH1cclxuXHJcbiAgICBhZGRFZGdlKGVkZ2Upe1xyXG4gICAgICAgIHRoaXMuZWRnZXMucHVzaChlZGdlKVxyXG4gICAgICAgIHRoaXMuZWRnZUluZGV4W2VkZ2UubGVmdFRhYmxlLmRlcHRoXS5wdXNoKGVkZ2UpXHJcbiAgICB9XHJcblxyXG4gICAgZW5zdXJlVW5pcXVlRWRnZXMoKXtcclxuICAgICAgICAvLyBmaW5pc2hcclxuICAgIH1cclxuXHJcbiAgICBnZXRFZGdlQ3Jvc3NpbmdzKCl7XHJcbiAgICAgICAgbGV0IGNvdW50ID0gMDtcclxuICAgICAgICBmb3IgKGxldCBkIGluIHRoaXMuZWRnZUluZGV4KSBjb3VudCArPSB0aGlzLmdldEVkZ2VDcm9zc2luZ3NBdERlcHRoKGQpO1xyXG4gICAgICAgIHJldHVybiBjb3VudDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRFZGdlQ3Jvc3NpbmdzQXREZXB0aChkKXtcclxuICAgICAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgICAgIGxldCBsYXllckVkZ2VzID0gdGhpcy5lZGdlSW5kZXhbZF07XHJcblxyXG4gICAgICAgIGZvciAobGV0IGkgaW4gbGF5ZXJFZGdlcyl7XHJcbiAgICAgICAgICAgIGxldCBjdXJyRWRnZSA9IGxheWVyRWRnZXNbaV07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSBwYXJzZUZsb2F0KGkpKzE7IGogPCBsYXllckVkZ2VzLmxlbmd0aDsgaisrKXtcclxuICAgICAgICAgICAgICAgIGxldCBvdGhlckVkZ2UgPSBsYXllckVkZ2VzW2pdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJFZGdlLmNyb3NzZXMob3RoZXJFZGdlKSlcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVkZ2UgXCIgKyBjdXJyRWRnZS5sZWZ0QXR0cmlidXRlLm5hbWUgKyBjdXJyRWRnZS5yaWdodEF0dHJpYnV0ZS5uYW1lICsgXCIgY3Jvc3NlcyBcIiArIG90aGVyRWRnZS5sZWZ0QXR0cmlidXRlLm5hbWUgKyBvdGhlckVkZ2UucmlnaHRBdHRyaWJ1dGUubmFtZSlcclxuICAgICAgICAgICAgICAgICAgICBjb3VudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gY291bnRcclxuICAgIH1cclxuXHJcbiAgICBzb3J0R3JhcGgoKXtcclxuICAgICAgICBmb3IgKGxldCB0IG9mIHRoaXMudGFibGVzKXtcclxuICAgICAgICAgICAgaWYgKCF0Lm1haW4pIHtcclxuICAgICAgICAgICAgICAgIHQuYXR0cmlidXRlcyA9IHQuYXR0cmlidXRlcy5zb3J0KChhLCBiKSA9PiBhLndlaWdodCA+IGIud2VpZ2h0PyAxIDogLTEpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMudGFibGVzID0gdGhpcy50YWJsZXMuc29ydCgoYSwgYikgPT4gYS53ZWlnaHQgPiBiLndlaWdodD8gMSA6IC0xKVxyXG4gICAgfVxyXG5cclxuICAgIHNldEV4YWN0V2VpZ2h0cygpe1xyXG4gICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy50YWJsZUluZGV4KXtcclxuICAgICAgICAgICAgbGV0IGxheWVyVGFibGVzID0gdGhpcy50YWJsZUluZGV4W2ldO1xyXG4gICAgICAgICAgICBsYXllclRhYmxlcyA9IGxheWVyVGFibGVzLnNvcnQoKGEsIGIpID0+IGEud2VpZ2h0ID4gYi53ZWlnaHQ/IDEgOiAtMSlcclxuICAgICAgICAgICAgZm9yIChsZXQgaiBpbiBsYXllclRhYmxlcyl7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGFibGUgPSBsYXllclRhYmxlc1tqXVxyXG4gICAgICAgICAgICAgICAgdGFibGUud2VpZ2h0ID0galxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBhdHRycyA9IHRhYmxlLmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgICAgICAgICBhdHRycyA9IGF0dHJzLnNvcnQoKGEsIGIpID0+IGEud2VpZ2h0ID4gYi53ZWlnaHQ/IDEgOiAtMSlcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayBpbiBhdHRycyl7XHJcbiAgICAgICAgICAgICAgICAgICAgYXR0cnNba10ud2VpZ2h0ID0ga1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiY2xhc3MgR3JhcGhHZW5lcmF0b3Ige1xyXG4gICAgY29uc3RydWN0b3IoZGVwdGg9Mywgc2VlZD1cImhlbGxvXCIsIHRhYmxlRGlzdHJpYnV0aW9uID0gWzIsM10sIGF0dHJpYnV0ZURpc3RyaWJ1dGlvbj1bMSwgNV0pe1xyXG4gICAgICAgIHRoaXMuZCA9IGRlcHRoO1xyXG4gICAgICAgIHRoaXMucyA9IDM7XHJcbiAgICAgICAgdGhpcy5qZCA9IDAuMTtcclxuICAgICAgICB0aGlzLmpzID0gMC4wNTtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZUNvdW50ZXIgPSAwO1xyXG4gICAgICAgIHRoaXMuc2VlZCA9IHNlZWQ7XHJcblxyXG4gICAgICAgIC8vIHJhbmRvbSBudW1iZXIgZ2VuZXJhdG9yc1xyXG4gICAgICAgIHRoaXMucm5nID0gbmV3IE1hdGguc2VlZHJhbmRvbSh0aGlzLnNlZWQpO1xyXG4gICAgICAgIHRoaXMudGFibGVEaXN0ID0gKCkgPT4gdGFibGVEaXN0cmlidXRpb25bMF0gKyBNYXRoLnJvdW5kKHRoaXMucm5nKCkgKiAodGFibGVEaXN0cmlidXRpb25bMV0gLSB0YWJsZURpc3RyaWJ1dGlvblswXSkpXHJcbiAgICAgICAgdGhpcy5hdHRyRGlzdCA9ICgpID0+IGF0dHJpYnV0ZURpc3RyaWJ1dGlvblswXSArIE1hdGgucm91bmQodGhpcy5ybmcoKSAqIChhdHRyaWJ1dGVEaXN0cmlidXRpb25bMV0gLSBhdHRyaWJ1dGVEaXN0cmlidXRpb25bMF0pKVxyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlKCl7XHJcbiAgICAgICAgZyA9IG5ldyBHcmFwaCgpXHJcblxyXG4gICAgICAgIGZvciAodmFyIGk9MTsgaTx0aGlzLmQ7IGkrKyl7XHJcbiAgICAgICAgICAgIGcubmV3TGF5ZXIoKVxyXG4gICAgICAgICAgICBmb3IgKHZhciBqPTA7IGo8dGhpcy50YWJsZURpc3QoKTsgaisrKXtcclxuICAgICAgICAgICAgICAgIGcuYWRkVGFibGUodGhpcy5nZW5lcmF0ZVRhYmxlKGksIGopKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLmdlbmVyYXRlUHJvamVjdGlvbnMoZyk7XHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZUpvaW5zKGcpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGcuZW5zdXJlVW5pcXVlRWRnZXMoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGc7XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVUYWJsZShkZXB0aCwgaW5kZXgpe1xyXG4gICAgICAgIG5hbWUgPSBcIlRcIiArIGRlcHRoICsgXCJfXCIgKyBpbmRleFxyXG4gICAgICAgIHZhciBuZXdUYWJsZSA9IG5ldyBUYWJsZShuYW1lLCBuYW1lLCBmYWxzZSwgZGVwdGgpO1xyXG5cclxuICAgICAgICBmb3IgKHZhciBpPTA7IGk8dGhpcy5hdHRyRGlzdCgpOyBpKyspe1xyXG4gICAgICAgICAgICBuZXdUYWJsZS5hZGRBdHRyaWJ1dGUoXCJhXCIgKyB0aGlzLmF0dHJpYnV0ZUNvdW50ZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZUNvdW50ZXIgKz0gMTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXdUYWJsZVxyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlUHJvamVjdGlvbnMoZyl7XHJcbiAgICAgICAgbGV0IGxheWVyMSA9IGcudGFibGVJbmRleFsxXTtcclxuICAgICAgICBsZXQgbGF5ZXIxYXR0cnMgPSBbXTtcclxuICAgICAgICBsZXQgc2VsZWN0VGFibGUgPSBuZXcgVGFibGUoXCJzZWxlY3RcIiwgXCJTRUxFQ1RcIiwgdHJ1ZSwgMClcclxuICAgICAgICBsZXQgcHJvamVjdGVkQXR0cnMgPSBbXTtcclxuICAgICAgICBsZXQgcHJvamVjdGVkID0gW107XHJcbiAgICAgICAgbGV0IHByb2plY3RlZENvdW50ID0gMDtcclxuXHJcbiAgICAgICAgZm9yIChsZXQgdCBvZiBsYXllcjEpe1xyXG4gICAgICAgICAgICBsZXQgYXR0cnMgPSB0LmF0dHJpYnV0ZXM7XHJcbiAgICAgICAgICAgIGxldCBzdHJpY3RJbmRleCA9IE1hdGguZmxvb3IodGhpcy5ybmcoKSphdHRycy5sZW5ndGgpXHJcbiAgICAgICAgICAgIGxldCBzdHJpY3QgPSBhdHRyc1tzdHJpY3RJbmRleF1cclxuICAgICAgICAgICAgcHJvamVjdGVkQXR0cnMucHVzaChzdHJpY3QpXHJcbiAgICAgICAgICAgIHByb2plY3RlZC5wdXNoKHN0cmljdClcclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgaWYgKGF0dHIgIT0gc3RyaWN0KXtcclxuICAgICAgICAgICAgICAgICAgICBsYXllcjFhdHRycy5wdXNoKG5ldyBBdHRyaWJ1dGUodCwgYXR0cikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcHJvamVjdGVkQ291bnQrKztcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBjb3VudFByb2plY3Rpb25zID0gdGhpcy5zICogKGxheWVyMWF0dHJzLmxlbmd0aCArIHByb2plY3RlZENvdW50KVxyXG5cclxuICAgICAgICBnLmFkZFRhYmxlKHNlbGVjdFRhYmxlKVxyXG5cclxuICAgICAgICBmb3IgKDsgcHJvamVjdGVkQ291bnQ8Y291bnRQcm9qZWN0aW9uczsgcHJvamVjdGVkQ291bnQrKyl7XHJcbiAgICAgICAgICAgIGxldCBhdHRySW5kZXggPSBNYXRoLmZsb29yKHRoaXMucm5nKCkqbGF5ZXIxYXR0cnMubGVuZ3RoKVxyXG4gICAgICAgICAgICBsZXQgYXR0ciA9IGxheWVyMWF0dHJzW2F0dHJJbmRleF1cclxuICAgICAgICAgICAgbGF5ZXIxYXR0cnMuc3BsaWNlKGF0dHJJbmRleCwgMSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGF0dHIgb2YgcHJvamVjdGVkQXR0cnMpe1xyXG4gICAgICAgICAgICBsZXQgbmV3QXR0ciA9IG5ldyBBdHRyaWJ1dGUoc2VsZWN0VGFibGUsIFwiYVwiICsgdGhpcy5hdHRyaWJ1dGVDb3VudGVyKyspXHJcbiAgICAgICAgICAgIHNlbGVjdFRhYmxlLmF0dHJpYnV0ZXMucHVzaChuZXdBdHRyKVxyXG4gICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2Uoc2VsZWN0VGFibGUsIG5ld0F0dHIsIGF0dHIudGFibGUsIGF0dHIpKVxyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIC8vIHdlaXJkLiBub3QgZmluaXNoZWQuXHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVJbnRlckxheWVySm9pbnMoZyl7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLmQ7IGkrKyl7XHJcbiAgICAgICAgICAgIGxldCBsZWZ0TGF5ZXIgPSBnLnRhYmxlSW5kZXhbaV07XHJcbiAgICAgICAgICAgIGxldCByaWdodExheWVyID0gZy50YWJsZUluZGV4W2kgKyAxXTtcclxuXHJcbiAgICAgICAgICAgIGxldCBsZWZ0TGF5ZXJBdHRycyA9IFtdO1xyXG4gICAgICAgICAgICBsZXQgcmlnaHRMYXllckF0dHJzID0gW107XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCB0YWJsZSBvZiBsZWZ0TGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgbGV0IGF0dHJzID0gdGFibGUuYXR0cmlidXRlcztcclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxlZnRMYXllckF0dHJzLnB1c2gobmV3IEF0dHJpYnV0ZSh0YWJsZSwgYXR0cikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IHRhYmxlIG9mIHJpZ2h0TGF5ZXIpe1xyXG4gICAgICAgICAgICAgICAgaWYgKGxlZnRMYXllckF0dHJzLmxlbmd0aCA9PSAwKSBicmVhaztcclxuICAgICAgICAgICAgICAgIGxldCBhdHRycyA9IHRhYmxlLmF0dHJpYnV0ZXM7XHJcblxyXG4gICAgICAgICAgICAgICAgbGV0IHN0cmljdCA9IGF0dHJzW01hdGguZmxvb3IodGhpcy5ybmcoKSphdHRycy5sZW5ndGgpXVxyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdEluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnJuZygpKmxlZnRMYXllckF0dHJzLmxlbmd0aClcclxuICAgICAgICAgICAgICAgIGxldCBsZWZ0ID0gbGVmdExheWVyQXR0cnNbbGVmdEluZGV4XVxyXG4gICAgICAgICAgICAgICAgbGVmdExheWVyQXR0cnMuc3BsaWNlKGxlZnRJbmRleCwgMSlcclxuXHJcbiAgICAgICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2UobGVmdC50YWJsZSwgbGVmdC5hdHRyLCB0YWJsZSwgc3RyaWN0KSlcclxuXHJcbiAgICAgICAgICAgICAgICBsZWZ0LmRpZmZFZGdlcysrO1xyXG4gICAgICAgICAgICAgICAgc3RyaWN0LmRpZmZFZGdlcysrO1xyXG5cclxuICAgICAgICAgICAgICAgIGZvciAobGV0IGF0dHIgb2YgYXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyICE9IHN0cmljdClcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHRMYXllckF0dHJzLnB1c2gobmV3IEF0dHJpYnV0ZSh0YWJsZSwgYXR0cikpXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGZvciAobGV0IGxlZnQgb2YgbGVmdExheWVyQXR0cnMpe1xyXG4gICAgICAgICAgICAgICAgaWYgKHJpZ2h0TGF5ZXJBdHRycy5sZW5ndGggPT0gMCkgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5ybmcoKSA8IHRoaXMuamQpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCByaWdodEluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnJuZygpKnJpZ2h0TGF5ZXJBdHRycy5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJpZ2h0ID0gcmlnaHRMYXllckF0dHJzW3JpZ2h0SW5kZXhdXHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHRMYXllckF0dHJzLnNwbGljZShyaWdodEluZGV4LCAxKVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2UobGVmdC50YWJsZSwgbGVmdC5hdHRyLCByaWdodC50YWJsZSwgcmlnaHQuYXR0cikpXHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxlZnQuZGlmZkVkZ2VzKys7XHJcbiAgICAgICAgICAgICAgICAgICAgcmlnaHQuZGlmZkVkZ2VzKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVJbkxheWVySm9pbnMoKXtcclxuICAgICAgICBmb3IgKHZhciBpPTE7IGk8dGhpcy5kOyBpKyspe1xyXG4gICAgICAgICAgICBsZXQgbGF5ZXIgPSBnLnRhYmxlSW5kZXhbaV07XHJcblxyXG4gICAgICAgICAgICBmb3IgKGxldCB0MSBvZiBsYXllcil7XHJcbiAgICAgICAgICAgICAgICBsZXQgYXR0cnMxID0gW107XHJcbiAgICAgICAgICAgICAgICBsZXQgYXR0cnMyID0gW107XHJcblxyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgYXR0ciBvZiB0MS5hdHRyaWJ1dGVzKXtcclxuICAgICAgICAgICAgICAgICAgICBhdHRyczEucHVzaChuZXcgQXR0cmlidXRlKHQxLCBhdHRyKSlcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB0MiBvZiBsYXllcil7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHQxID09IHQyKSBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhdHRyIG9mIHQyLmF0dHJpYnV0ZXMpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXR0ci5zYW1lRWRnZXMgPT0gMClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJzMi5wdXNoKG5ldyBBdHRyaWJ1dGUodDIsIGF0dHIpKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBhdHRyMSBvZiBhdHRyczEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChhdHRyczIubGVuZ3RoID09IDApIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnJuZygpIDwgdGhpcy5qcyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdHRyMmluZGV4ID0gTWF0aC5mbG9vcih0aGlzLnJuZygpKmF0dHJzMi5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBhdHRyMiA9IGF0dHJzMlthdHRyMmluZGV4XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyczIuc3BsaWNlKGF0dHIyaW5kZXgsIDEpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBnLmFkZEVkZ2UobmV3IEVkZ2UoYXR0cjEudGFibGUsIGF0dHIxLmF0dHIsIGF0dHIyLnRhYmxlLCBhdHRyMi5hdHRyKSlcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHIxLnNhbWVFZGdlcysrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBhdHRyMi5zYW1lRWRnZXMrKztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVSYW5kb21Kb2lucygpe1xyXG4gICAgICAgIC8vIGZpbmlzaFxyXG4gICAgfVxyXG5cclxuICAgIGdlbmVyYXRlSm9pbnMoZyl7XHJcbiAgICAgICAgdGhpcy5nZW5lcmF0ZUludGVyTGF5ZXJKb2lucyhnKTtcclxuICAgICAgICB0aGlzLmdlbmVyYXRlSW5MYXllckpvaW5zKGcpO1xyXG4gICAgICAgIHRoaXMuZ2VuZXJhdGVSYW5kb21Kb2lucyhnKTtcclxuICAgIH1cclxufSIsImNsYXNzIFRhYmxlIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUsIGhlYWRlciwgbWFpbiwgZGVwdGgpe1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5oZWFkZXIgPSBoZWFkZXI7XHJcbiAgICAgICAgdGhpcy5tYWluID0gbWFpbjtcclxuICAgICAgICB0aGlzLmRlcHRoID0gZGVwdGg7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVzID0gW107XHJcbiAgICAgICAgdGhpcy5hdHRyTWFwcyA9IFtdO1xyXG4gICAgICAgIHRoaXMud2VpZ2h0ID0gMDtcclxuICAgIH1cclxuXHJcbiAgICBhZGRBdHRyaWJ1dGUoYXR0cmlidXRlKXtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMucHVzaChuZXcgQXR0cmlidXRlKHRoaXMsIGF0dHJpYnV0ZSkpXHJcbiAgICB9XHJcblxyXG4gICAgY29tcGFyZVRvKG90aGVyVGFibGUpe1xyXG4gICAgICAgIGlmICh0aGlzLmRlcHRoIDwgb3RoZXJUYWJsZS5kZXB0aCkgcmV0dXJuIC0xO1xyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZGVwdGggPiBvdGhlclRhYmxlLmRlcHRoKSByZXR1cm4gMTtcclxuICAgICAgICBlbHNlIHJldHVybiB0aGlzLndlaWdodCA+IG90aGVyVGFibGUud2VpZ2h0O1xyXG4gICAgfVxyXG59Il19
